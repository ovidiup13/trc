services:
  minio:
    image: minio/minio:latest
    command: server /data --console-address ":9001"
    user: "${E2E_UID:-0}:${E2E_GID:-0}"
    environment:
      MINIO_ROOT_USER: "${E2E_S3_ACCESS_KEY}"
      MINIO_ROOT_PASSWORD: "${E2E_S3_SECRET_KEY}"
    volumes:
      - "${E2E_S3_DATA_DIR}:/data"
    networks:
      - e2e
  trc:
    image: trc-e2e-server:latest
    ports:
      - "${E2E_TRC_PORT}:3000"
    depends_on:
      - minio
    volumes:
      - "${E2E_CONFIG_DIR}:/config"
    environment:
      TRC_CONFIG: /config/trc.yaml
    networks:
      - e2e
  runner:
    image: trc-e2e-runner:latest
    depends_on:
      - trc
    volumes:
      - "${E2E_CACHE_DIR}:/workspace/examples/basic/.turbo"
    environment:
      TURBO_TOKEN: "${E2E_TURBO_TOKEN}"
      E2E_TURBO_API_URL: "${E2E_TURBO_API_URL}"
      TURBO_CACHE_DIR: /workspace/examples/basic/.turbo/cache
      TURBO_LOG_DIR: /workspace/examples/basic/.turbo/cache
    networks:
      - e2e
  minio-client:
    image: minio/mc:latest
    depends_on:
      - minio
    entrypoint: /bin/sh
    networks:
      - e2e

networks:
  e2e:
    name: "${E2E_NETWORK_NAME}"
