# S3 storage provider

## Overview

The S3 provider stores artifacts in an S3-compatible bucket. Artifact metadata is stored as object metadata (size, duration, and optional tag).

## Configuration

```yaml
storage:
  provider: s3
  s3:
    endpoint: http://localhost:9000
    region: us-east-1
    bucket: trc-cache
    accessKeyId: your-access-key
    secretAccessKey: your-secret-key
    forcePathStyle: true
```

Required fields:

- `region`
- `bucket`
- `accessKeyId`
- `secretAccessKey`

Optional fields:

- `endpoint`: S3-compatible endpoint (use for MinIO or other vendors).
- `forcePathStyle`: set to `true` for MinIO and many S3-compatible services.

## Setup

1. Create a bucket in your S3-compatible storage.
2. Ensure your credentials have read/write access to the bucket.
3. Point `TRC_CONFIG` to a config file that sets `storage.provider: s3`.
4. Start the server: `npx trc -c /path/to/trc.yaml`.

## Local testing with MinIO

This repo includes a MinIO-backed e2e test that provisions a bucket and runs a Turborepo example against the TRC server.

Run the e2e test:

```sh
bun run --filter @trc/e2e test:e2e
```

If you want to run MinIO manually:

```sh
docker run --rm -p 9000:9000 -p 9001:9001 \
  -e MINIO_ROOT_USER=minio-access \
  -e MINIO_ROOT_PASSWORD=minio-secret \
  minio/minio:latest server /data --console-address ":9001"
```

Then create a bucket with `mc` and point `endpoint` to `http://localhost:9000`.
